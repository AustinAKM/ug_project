<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AutoSphere - Your Trusted Automotive Marketplace</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <link rel="stylesheet" href="style.css" />
    <style>
      /* Enhanced image styles */
      .car-image {
        position: relative;
        overflow: hidden;
        border-radius: 8px;
      }
      
      .car-image img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        transition: transform 0.3s ease;
      }
      
      .car-image:hover img {
        transform: scale(1.05);
      }
      
      .image-placeholder {
        width: 100%;
        height: 200px;
        border-radius: 8px;
      }
      
      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .image-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 200px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      /* Car Details Styles */
      .car-details-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      .car-details-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        margin-bottom: 3rem;
      }

      .car-gallery {
        position: relative;
      }

      .main-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 1rem;
      }

      .thumbnail-row {
        display: flex;
        gap: 0.5rem;
        overflow-x: auto;
      }

      .thumbnail {
        width: 80px;
        height: 60px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.3s ease;
      }

      .thumbnail.active {
        border-color: var(--primary-color);
      }

      .car-info-section {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }

      .price-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--gray-light);
      }

      .main-price {
        font-size: 2.5rem;
        font-weight: bold;
        color: var(--primary-color);
      }

      .price-note {
        color: var(--gray-medium);
        font-size: 0.9rem;
      }

      .car-specs-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .spec-item {
        display: flex;
        justify-content: space-between;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f0f0f0;
      }

      .spec-label {
        color: var(--gray-medium);
        font-weight: 500;
      }

      .spec-value {
        font-weight: 600;
        color: var(--text-dark);
      }

      .action-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .feature-tabs {
        display: flex;
        border-bottom: 2px solid var(--gray-light);
        margin-bottom: 2rem;
      }

      .feature-tab {
        padding: 1rem 2rem;
        border: none;
        background: none;
        cursor: pointer;
        font-weight: 500;
        color: var(--gray-medium);
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .feature-tab.active {
        color: var(--primary-color);
        border-bottom-color: var(--primary-color);
      }

      .feature-content {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }

      .installment-calculator {
        background: var(--gray-light);
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
      }

      .calculator-row {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .calculator-result {
        background: var(--primary-color);
        color: white;
        padding: 1.5rem;
        border-radius: 8px;
        text-align: center;
        margin-top: 1rem;
      }

      .test-drive-form {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }

      .purchase-progress {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
      }

      .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        position: relative;
      }

      .progress-step:not(:last-child)::after {
        content: '';
        position: absolute;
        top: 15px;
        right: -50%;
        width: 100%;
        height: 2px;
        background: var(--gray-light);
      }

      .progress-step.active::after {
        background: var(--primary-color);
      }

      .step-circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: var(--gray-light);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }

      .progress-step.active .step-circle {
        background: var(--primary-color);
      }

      .back-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--primary-color);
        text-decoration: none;
        margin-bottom: 2rem;
        cursor: pointer;
      }

      /* Modal Styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .modal-title {
        margin: 0;
        color: var(--primary-color);
      }

      .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray-medium);
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text-dark);
      }

      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--gray-light);
        border-radius: 6px;
        font-size: 1rem;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
      }

      /* Button Styles */
      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: #0056b3;
      }

      .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
      }

      .btn-outline:hover {
        background: var(--primary-color);
        color: white;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #218838;
      }

      /* Toast Styles */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
      }

      .toast {
        background: white;
        border-radius: 8px;
        padding: 1rem 1.5rem;
        margin-bottom: 0.5rem;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border-left: 4px solid var(--primary-color);
        animation: slideIn 0.3s ease;
      }

      .toast.error {
        border-left-color: #dc3545;
      }

      .toast.success {
        border-left-color: #28a745;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .car-details-header {
          grid-template-columns: 1fr;
          gap: 2rem;
        }

        .calculator-row {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          grid-template-columns: 1fr;
        }

        .car-specs-grid {
          grid-template-columns: 1fr;
        }
      }

      /* CSS Variables (add these if not already present) */
      :root {
        --primary-color: #007bff;
        --text-dark: #333;
        --text-light: #666;
        --gray-light: #e9ecef;
        --gray-medium: #6c757d;
        --highlight-color: #28a745;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- Navigation -->
      <nav class="navbar">
        <div class="nav-container">
          <a class="logo" @click.prevent="currentView = 'home'">AutoSphere</a>
          <div class="nav-links">
            <a
              class="nav-link"
              :class="{active: currentView === 'home'}"
              @click="currentView = 'home'"
              >Home</a
            >
            <a
              class="nav-link"
              :class="{active: currentView === 'browse'}"
              @click="currentView = 'browse'"
              >Browse Cars</a
            >
            <a
              class="nav-link"
              :class="{active: currentView === 'favorites'}"
              @click="currentView = 'favorites'"
              >My Favorites</a
            >
            <a
              class="nav-link"
              :class="{active: currentView === 'sell'}"
              @click="currentView = 'sell'"
              >Sell Your Car</a
            >
            <a class="nav-link" @click="currentView = 'about'">About</a>
          </div>
          <div class="user-actions">
            <button
              v-if="!isLoggedIn"
              class="btn btn-outline"
              @click="openLogin"
            >
              Login
            </button>
            <button
              v-if="!isLoggedIn"
              class="btn btn-primary"
              @click="openSignup"
            >
              Sign Up
            </button>
            <div
              v-if="isLoggedIn"
              style="display: flex; align-items: center; gap: 1rem"
            >
              <span style="color: var(--text-light)"
                >Welcome, {{ user.name }}!</span
              >
              <button class="btn btn-outline" @click="logout">Logout</button>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main>
        <!-- Car Details View -->
        <div v-if="currentView === 'carDetails' && selectedCar" class="car-details-container">
          <div class="back-button" @click="goBack">
            ‚Üê Back to {{ previousView === 'browse' ? 'Browse' : 'Home' }}
          </div>

          <div class="car-details-header">
            <!-- Car Gallery -->
            <div class="car-gallery">
              <img 
                :src="currentImageUrl" 
                :alt="`${selectedCar.make} ${selectedCar.model}`"
                class="main-image"
                @error="handleImageError($event, selectedCar)"
              />
              <div class="thumbnail-row" v-if="carImageUrls.length > 1">
                <img 
                  v-for="(imageUrl, index) in carImageUrls" 
                  :key="index"
                  :src="imageUrl"
                  :alt="`${selectedCar.make} ${selectedCar.model} image ${index + 1}`"
                  class="thumbnail"
                  :class="{ active: currentImageIndex === index }"
                  @click="currentImageIndex = index"
                  @error="handleImageError($event, selectedCar)"
                />
              </div>
            </div>

            <!-- Car Information -->
            <div class="car-info-section">
              <h1 style="margin-bottom: 1rem;">{{ selectedCar.make }} {{ selectedCar.model }}</h1>
              
              <div class="price-section">
                <div>
                  <div class="main-price">AED {{ selectedCar.price?.toLocaleString() || 'N/A' }}</div>
                  <div class="price-note">*Price includes registration and basic warranty</div>
                </div>
                <button
                  class="favorite-btn"
                  :class="{active: isFavorite(selectedCar._id)}"
                  @click="toggleFavorite(selectedCar)"
                  style="font-size: 1.5rem; background: none; border: none; cursor: pointer;"
                >
                  {{ isFavorite(selectedCar._id) ? '‚ù§Ô∏è' : 'ü§ç' }}
                </button>
              </div>

              <div class="car-specs-grid">
                <div class="spec-item">
                  <span class="spec-label">Year</span>
                  <span class="spec-value">{{ selectedCar.year }}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Mileage</span>
                  <span class="spec-value">{{ selectedCar.mileage?.toLocaleString() || 'N/A' }} km</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Fuel Type</span>
                  <span class="spec-value">{{ selectedCar.fuel }}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Transmission</span>
                  <span class="spec-value">{{ selectedCar.transmission || 'Automatic' }}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Color</span>
                  <span class="spec-value">{{ selectedCar.color || 'Not specified' }}</span>
                </div>
                <div class="spec-item">
                  <span class="spec-label">Body Type</span>
                  <span class="spec-value">{{ selectedCar.bodyType || 'Sedan' }}</span>
                </div>
              </div>

              <div class="action-buttons">
                <button class="btn btn-primary" @click="openTestDriveModal">
                  üöó Book Test Drive
                </button>
                <button class="btn btn-success" @click="startPurchaseProcess">
                  üí≥ Buy Now
                </button>
              </div>
            </div>
          </div>

          <!-- Feature Tabs -->
          <div class="feature-tabs">
            <button 
              class="feature-tab" 
              :class="{ active: activeTab === 'installments' }"
              @click="activeTab = 'installments'"
            >
              üí∞ Financing & Installments
            </button>
            <button 
              class="feature-tab" 
              :class="{ active: activeTab === 'details' }"
              @click="activeTab = 'details'"
            >
              üìã Detailed Specs
            </button>
            <button 
              class="feature-tab" 
              :class="{ active: activeTab === 'features' }"
              @click="activeTab = 'features'"
            >
              ‚≠ê Features & Extras
            </button>
            <button 
              class="feature-tab" 
              :class="{ active: activeTab === 'history' }"
              @click="activeTab = 'history'"
            >
              üìÑ Vehicle History
            </button>
          </div>

          <div class="feature-content">
            <!-- Financing & Installments Tab -->
            <div v-if="activeTab === 'installments'">
              <h3 style="margin-bottom: 2rem;">Financing Options</h3>
              
              <div class="installment-calculator">
                <h4 style="margin-bottom: 1.5rem;">üí≥ Installment Calculator</h4>
                
                <div class="calculator-row">
                  <div class="form-group">
                    <label class="form-label">Down Payment (AED)</label>
                    <input 
                      type="number" 
                      class="form-input" 
                      v-model="installmentCalc.downPayment"
                      :placeholder="Math.round(selectedCar.price * 0.2)"
                      @input="calculateInstallment"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Loan Term (Years)</label>
                    <select class="form-input" v-model="installmentCalc.years" @change="calculateInstallment">
                      <option value="2">2 Years</option>
                      <option value="3">3 Years</option>
                      <option value="4">4 Years</option>
                      <option value="5">5 Years</option>
                      <option value="7">7 Years</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Interest Rate (%)</label>
                    <select class="form-input" v-model="installmentCalc.interestRate" @change="calculateInstallment">
                      <option value="3.5">3.5% (Excellent Credit)</option>
                      <option value="4.5">4.5% (Good Credit)</option>
                      <option value="6.0">6.0% (Fair Credit)</option>
                      <option value="8.0">8.0% (Poor Credit)</option>
                    </select>
                  </div>
                </div>

                <div class="calculator-result">
                  <h4 style="margin-bottom: 1rem;">Monthly Payment: AED {{ monthlyPayment.toLocaleString() }}</h4>
                  <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; font-size: 0.9rem;">
                    <div>
                      <strong>Loan Amount:</strong><br>
                      AED {{ loanAmount.toLocaleString() }}
                    </div>
                    <div>
                      <strong>Total Interest:</strong><br>
                      AED {{ totalInterest.toLocaleString() }}
                    </div>
                    <div>
                      <strong>Total Payment:</strong><br>
                      AED {{ totalPayment.toLocaleString() }}
                    </div>
                  </div>
                </div>
              </div>

              <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                <h4 style="margin-bottom: 1.5rem;">üè¶ Available Financing Partners</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                  <div style="border: 1px solid var(--gray-light); padding: 1.5rem; border-radius: 8px;">
                    <h5 style="color: var(--primary-color); margin-bottom: 1rem;">Emirates NBD Auto Loan</h5>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                      <li style="margin-bottom: 0.5rem;">‚úì Up to 85% financing</li>
                      <li style="margin-bottom: 0.5rem;">‚úì Rates from 3.5% APR</li>
                      <li style="margin-bottom: 0.5rem;">‚úì Quick approval in 24 hours</li>
                      <li>‚úì Flexible repayment terms</li>
                    </ul>
                  </div>
                  <div style="border: 1px solid var(--gray-light); padding: 1.5rem; border-radius: 8px;">
                    <h5 style="color: var(--primary-color); margin-bottom: 1rem;">ADCB Auto Finance</h5>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                      <li style="margin-bottom: 0.5rem;">‚úì Up to 90% financing</li>
                      <li style="margin-bottom: 0.5rem;">‚úì Competitive rates</li>
                      <li style="margin-bottom: 0.5rem;">‚úì No processing fees</li>
                      <li>‚úì Insurance options available</li>
                    </ul>
                  </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                  <button class="btn btn-primary" @click="applyForFinancing">
                    üìù Apply for Pre-Approval
                  </button>
                </div>
              </div>
            </div>

            <!-- Detailed Specs Tab -->
            <div v-if="activeTab === 'details'">
              <h3 style="margin-bottom: 2rem;">Detailed Specifications</h3>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
                <div>
                  <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üöó Engine & Performance</h4>
                  <div class="spec-item">
                    <span class="spec-label">Engine Type</span>
                    <span class="spec-value">{{ selectedCar.engineType || '2.0L 4-Cylinder' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Horsepower</span>
                    <span class="spec-value">{{ selectedCar.horsepower || '150 HP' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Torque</span>
                    <span class="spec-value">{{ selectedCar.torque || '200 Nm' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Top Speed</span>
                    <span class="spec-value">{{ selectedCar.topSpeed || '180 km/h' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">0-100 km/h</span>
                    <span class="spec-value">{{ selectedCar.acceleration || '9.5 seconds' }}</span>
                  </div>
                </div>
                
                <div>
                  <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üìè Dimensions</h4>
                  <div class="spec-item">
                    <span class="spec-label">Length</span>
                    <span class="spec-value">{{ selectedCar.length || '4.5 m' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Width</span>
                    <span class="spec-value">{{ selectedCar.width || '1.8 m' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Height</span>
                    <span class="spec-value">{{ selectedCar.height || '1.5 m' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Boot Space</span>
                    <span class="spec-value">{{ selectedCar.bootSpace || '500 L' }}</span>
                  </div>
                  <div class="spec-item">
                    <span class="spec-label">Seating</span>
                    <span class="spec-value">{{ selectedCar.seating || '5 Passengers' }}</span>
                  </div>
                </div>
              </div>

              <div style="margin-top: 3rem;">
                <h4 style="color: var(--primary-color); margin-bottom: 1rem;">‚õΩ Fuel Economy</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem;">
                  <div style="text-align: center; padding: 1.5rem; background: var(--gray-light); border-radius: 8px;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèôÔ∏è</div>
                    <div style="font-weight: bold; margin-bottom: 0.5rem;">City</div>
                    <div>{{ selectedCar.fuelEconomyCity || '12 L/100km' }}</div>
                  </div>
                  <div style="text-align: center; padding: 1.5rem; background: var(--gray-light); border-radius: 8px;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üõ£Ô∏è</div>
                    <div style="font-weight: bold; margin-bottom: 0.5rem;">Highway</div>
                    <div>{{ selectedCar.fuelEconomyHighway || '8 L/100km' }}</div>
                  </div>
                  <div style="text-align: center; padding: 1.5rem; background: var(--gray-light); border-radius: 8px;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚öñÔ∏è</div>
                    <div style="font-weight: bold; margin-bottom: 0.5rem;">Combined</div>
                    <div>{{ selectedCar.fuelEconomyCombined || '10 L/100km' }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Features & Extras Tab -->
            <div v-if="activeTab === 'features'">
              <h3 style="margin-bottom: 2rem;">Features & Equipment</h3>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
                <div>
                  <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üõ°Ô∏è Safety Features</h4>
                  <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 0.5rem;">‚úì ABS Braking System</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Electronic Stability Control</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Multiple Airbags</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Parking Sensors</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Reverse Camera</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Blind Spot Monitoring</li>
                    <li>‚úì Lane Departure Warning</li>
                  </ul>
                  
                  <h4 style="color: var(--primary-color); margin: 2rem 0 1rem 0;">üéµ Entertainment</h4>
                  <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 0.5rem;">‚úì Touchscreen Infotainment</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Bluetooth Connectivity</li>
                    <li style="margin-bottom: 0.5rem;">‚úì USB Ports</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Premium Sound System</li>
                    <li>‚úì Navigation System</li>
                  </ul>
                </div>
                
                <div>
                  <h4 style="color: var(--primary-color); margin-bottom: 1rem;">‚ùÑÔ∏è Comfort Features</h4>
                  <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 0.5rem;">‚úì Automatic Climate Control</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Power Steering</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Electric Windows</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Keyless Entry</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Push Start Button</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Cruise Control</li>
                    <li>‚úì Adjustable Seats</li>
                  </ul>
                  
                  <h4 style="color: var(--primary-color); margin: 2rem 0 1rem 0;">üíé Premium Options</h4>
                  <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 0.5rem;">‚úì Leather Seats</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Sunroof</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Alloy Wheels</li>
                    <li style="margin-bottom: 0.5rem;">‚úì Fog Lights</li>
                    <li>‚úì Tinted Windows</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Vehicle History Tab -->
            <div v-if="activeTab === 'history'">
              <h3 style="margin-bottom: 2rem;">Vehicle History & Condition</h3>
              
              <div style="display: grid; gap: 2rem;">
                <div style="background: #f8f9fa; padding: 2rem; border-radius: 12px; border-left: 4px solid var(--highlight-color);">
                  <h4 style="color: var(--highlight-color); margin-bottom: 1rem;">‚úÖ Verified & Inspected</h4>
                  <p>This vehicle has passed our comprehensive 120-point inspection and comes with a detailed condition report.</p>
                  <div style="margin-top: 1rem;">
                    <span style="background: var(--highlight-color); color: white; padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                      INSPECTION PASSED
                    </span>
                  </div>
                </div>

                <div style="background: white; padding: 2rem; border-radius: 12px; border: 1px solid var(--gray-light);">
                  <h4 style="color: var(--primary-color); margin-bottom: 1.5rem;">üìã Inspection Report</h4>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <div>
                      <div class="spec-item">
                        <span class="spec-label">Engine Condition</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Excellent</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">Transmission</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Very Good</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">Brakes</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Good</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">Suspension</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Very Good</span>
                      </div>
                    </div>
                    <div>
                      <div class="spec-item">
                        <span class="spec-label">Body Condition</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Excellent</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">Interior</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Very Good</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">Tires</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Good</span>
                      </div>
                      <div class="spec-item">
                        <span class="spec-label">Electronics</span>
                        <span class="spec-value" style="color: var(--highlight-color);">‚úÖ Excellent</span>
                      </div>
                    </div>
                  </div>
                </div>

                <div style="background: white; padding: 2rem; border-radius: 12px; border: 1px solid var(--gray-light);">
                  <h4 style="color: var(--primary-color); margin-bottom: 1.5rem;">üõ°Ô∏è Warranty & Service</h4>
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                      <h5 style="margin-bottom: 1rem;">Warranty Included</h5>
                      <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 0.5rem;">‚úì 6 months comprehensive warranty</li>
                        <li style="margin-bottom: 0.5rem;">‚úì 24/7 roadside assistance</li>
                        <li>‚úì Free first service</li>
                      </ul>
                    </div>
                    <div>
                      <h5 style="margin-bottom: 1rem;">Service History</h5>
                      <ul style="list-style: none; padding: 0;">
                        <li style="margin-bottom: 0.5rem;">‚úì Regular maintenance records</li>
                        <li style="margin-bottom: 0.5rem;">‚úì Authorized service centers</li>
                        <li>‚úì All receipts available</li>
                      </ul>
                    </div>
                  </div>
                </div>

                <div style="background: white; padding: 2rem; border-radius: 12px; border: 1px solid var(--gray-light);">
                  <h4 style="color: var(--primary-color); margin-bottom: 1.5rem;">üîí Our Guarantee</h4>
                  <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; text-align: center;">
                    <div>
                      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üîÑ</div>
                      <h5>7-Day Return</h5>
                      <p style="font-size: 0.9rem; color: var(--gray-medium);">Not satisfied? Return within 7 days</p>
                    </div>
                    <div>
                      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üõ°Ô∏è</div>
                      <h5>Protected Purchase</h5>
                      <p style="font-size: 0.9rem; color: var(--gray-medium);">Your money is safe with our guarantee</p>
                    </div>
                    <div>
                      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìû</div>
                      <h5>24/7 Support</h5>
                      <p style="font-size: 0.9rem; color: var(--gray-medium);">We're here whenever you need us</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Home View -->
        <div v-if="currentView === 'home'">
          <!-- Hero Section -->
          <section class="hero">
            <div class="container">
              <h1>Find Your Perfect Car</h1>
              <p>
                Discover the best deals on quality vehicles with our
                personalized recommendations
              </p>
              <div class="search-container">
                <div class="search-bar">
                  <input
                    type="text"
                    class="search-input"
                    v-model="searchQuery"
                    placeholder="Search by make, model, or keyword..."
                  />
                  <button class="search-btn" @click="searchCars">Search</button>
                </div>
              </div>
            </div>
          </section>

          <!-- Features Section -->
          <section class="features">
            <div class="container">
              <h2
                style="
                  text-align: center;
                  font-size: 2.5rem;
                  margin-bottom: 1rem;
                "
              >
                Why Choose AutoSphere?
              </h2>
              <p
                style="
                  text-align: center;
                  color: var(--gray-medium);
                  font-size: 1.1rem;
                "
              >
                Experience the future of car buying with our innovative platform
              </p>
              <div class="features-grid">
                <div class="feature-card">
                  <div class="feature-icon">üéØ</div>
                  <h3 class="feature-title">Personalized Recommendations</h3>
                  <p class="feature-description">
                    Our AI-powered system finds cars that match your preferences
                    and budget
                  </p>
                </div>
                <div class="feature-card">
                  <div class="feature-icon">‚ú®</div>
                  <h3 class="feature-title">Transparent Pricing</h3>
                  <p class="feature-description">
                    See complete pricing breakdowns including taxes, fees, and
                    insurance options
                  </p>
                </div>
                <div class="feature-card">
                  <div class="feature-icon">üõ°Ô∏è</div>
                  <h3 class="feature-title">Verified Listings</h3>
                  <p class="feature-description">
                    All vehicles undergo thorough verification to ensure quality
                    and authenticity
                  </p>
                </div>
                <div class="feature-card">
                  <div class="feature-icon">üì±</div>
                  <h3 class="feature-title">Seamless Experience</h3>
                  <p class="feature-description">
                    Browse, compare, and purchase from the comfort of your home
                  </p>
                </div>
              </div>
            </div>
          </section>

          <!-- Featured Cars -->
          <section class="container">
            <h2 style="font-size: 2rem; margin-bottom: 2rem">
              Featured Vehicles
            </h2>
            
            <!-- Loading State for Featured Cars -->
            <div v-if="loadingFeatured" style="text-align: center; padding: 4rem 0">
              <div class="loading-spinner"></div>
              <p style="margin-top: 1rem; color: var(--gray-medium)">Loading featured cars...</p>
            </div>
            
            <!-- Featured Cars Grid -->
            <div v-else class="car-grid">
              <div
                v-for="car in featuredCars"
                :key="car._id"
                class="car-card"
                @click="viewCarDetails(car)"
              >
                <div class="car-image">
                  <img 
                    :src="getCarImageUrl(car)" 
                    :alt="`${car.make} ${car.model} ${car.year}`"
                    @error="handleImageError($event, car)"
                    loading="lazy"
                  />
                </div>
                <div class="car-details">
                  <h3 class="car-title">{{ car.make }} {{ car.model }}</h3>
                  <div class="car-specs">
                    <span>{{ car.year }}</span>
                    <span>‚Ä¢</span>
                    <span>{{ car.mileage?.toLocaleString() || 'N/A' }} km</span>
                    <span>‚Ä¢</span>
                    <span>{{ car.fuel }}</span>
                  </div>
                  <div class="car-price">
                    AED {{ car.price?.toLocaleString() || 'N/A' }}
                  </div>
                  <div class="car-actions">
                    <button class="btn btn-primary" style="flex: 1">
                      View Details
                    </button>
                    <button
                      class="favorite-btn"
                      :class="{active: isFavorite(car._id)}"
                      @click.stop="toggleFavorite(car)"
                    >
                      {{ isFavorite(car._id) ? '‚ù§Ô∏è' : 'ü§ç' }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Browse Cars View -->
        <div v-if="currentView === 'browse'" class="container">
          <h1 style="margin-bottom: 2rem">Browse All Cars</h1>

          <!-- Filters -->
          <div class="filters">
            <h3 style="margin-bottom: 1rem">Filter Your Search</h3>
            <div class="filter-grid">
              <div class="filter-group">
                <label class="filter-label">Make</label>
                <select class="filter-select" v-model="filters.make">
                  <option value="">All Makes</option>
                  <option value="Toyota">Toyota</option>
                  <option value="Honda">Honda</option>
                  <option value="Mercedes">Mercedes-Benz</option>
                  <option value="BMW">BMW</option>
                  <option value="Nissan">Nissan</option>
                  <option value="Audi">Audi</option>
                  <option value="Porsche">Porsche</option>
                  <option value="Range Rover">Range Rover</option>
                  <option value="Tesla">Tesla</option>
                  <option value="Mazda">Mazda</option>
                  <option value="Ford">Ford</option>
                  <option value="Chevrolet">Chevrolet</option>
                  <option value="Kia">Kia</option>
                  <option value="Hyundai">Hyundai</option>
                  <option value="Volkswagen">Volkswagen</option>
                  <option value="Mitsubishi">Mitsubishi</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Price Range</label>
                <select class="filter-select" v-model="filters.priceRange">
                  <option value="">Any Price</option>
                  <option value="0-50000">Under AED 50,000</option>
                  <option value="50000-100000">AED 50,000 - 100,000</option>
                  <option value="100000-200000">AED 100,000 - 200,000</option>
                  <option value="200000+">Above AED 200,000</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Year</label>
                <select class="filter-select" v-model="filters.year">
                  <option value="">Any Year</option>
                  <option value="2025">2025</option>
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                </select>
              </div>
              <div class="filter-group">
                <label class="filter-label">Fuel Type</label>
                <select class="filter-select" v-model="filters.fuel">
                  <option value="">Any Fuel Type</option>
                  <option value="Petrol">Petrol</option>
                  <option value="Diesel">Diesel</option>
                  <option value="Hybrid">Hybrid</option>
                  <option value="Electric">Electric</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Loading State -->
          <div v-if="loadingCars" style="text-align: center; padding: 4rem 0">
            <div class="loading-spinner"></div>
            <p style="margin-top: 1rem; font-size: 1.2rem; color: var(--gray-medium)">
              Loading cars...
            </p>
          </div>

          <!-- No Cars Found -->
          <div
            v-else-if="!loadingCars && cars.length === 0"
            style="text-align: center; padding: 4rem 0"
          >
            <div style="font-size: 3rem; margin-bottom: 1rem">üîç</div>
            <h3 style="margin-bottom: 1rem">No cars found</h3>
            <p style="color: var(--gray-medium); margin-bottom: 2rem">
              Try adjusting your filters or search terms to find more results.
            </p>
            <button
              class="btn btn-primary"
              @click="filters = {make: '', priceRange: '', year: '', fuel: ''}"
            >
              Clear Filters
            </button>
          </div>

          <!-- Car Grid -->
          <div v-else class="car-grid">
            <div
              v-for="car in cars"
              :key="car._id"
              class="car-card"
              @click="viewCarDetails(car)"
            >
              <div class="car-image">
                <img 
                  :src="getCarImageUrl(car)" 
                  :alt="`${car.make} ${car.model} ${car.year}`"
                  @error="handleImageError($event, car)"
                  loading="lazy"
                />
              </div>
              <div class="car-details">
                <h3 class="car-title">{{ car.make }} {{ car.model }}</h3>
                <div class="car-specs">
                  <span>{{ car.year }}</span>
                  <span>‚Ä¢</span>
                  <span>{{ car.mileage?.toLocaleString() || 'N/A' }} km</span>
                  <span>‚Ä¢</span>
                  <span>{{ car.fuel }}</span>
                </div>
                <div class="car-price">
                  AED {{ car.price?.toLocaleString() || 'N/A' }}
                </div>
                <div class="car-actions">
                  <button class="btn btn-primary" style="flex: 1">
                    View Details
                  </button>
                  <button
                    class="favorite-btn"
                    :class="{active: isFavorite(car._id)}"
                    @click.stop="toggleFavorite(car)"
                  >
                    {{ isFavorite(car._id) ? '‚ù§Ô∏è' : 'ü§ç' }}
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Pagination -->
          <div
            v-if="pagination.pages > 1"
            class="pagination"
            style="margin-top: 3rem"
          >
            <button
              class="btn btn-outline"
              @click="changePage(pagination.current - 1)"
              :disabled="pagination.current === 1"
            >
              Previous
            </button>
            <span style="margin: 0 1rem">
              Page {{ pagination.current }} of {{ pagination.pages }}
            </span>
            <button
              class="btn btn-outline"
              @click="changePage(pagination.current + 1)"
              :disabled="pagination.current === pagination.pages"
            >
              Next
            </button>
          </div>
        </div>

        <!-- Favorites View -->
        <div v-if="currentView === 'favorites'" class="container">
          <h1 style="margin-bottom: 2rem">My Favorite Cars</h1>
          
          <!-- Loading State -->
          <div v-if="loadingFavorites" style="text-align: center; padding: 4rem 0">
            <div class="loading-spinner"></div>
            <p style="margin-top: 1rem; color: var(--gray-medium)">Loading favorites...</p>
          </div>
          
          <!-- Empty Favorites -->
          <div
            v-else-if="favorites.length === 0"
            style="text-align: center; padding: 4rem 0"
          >
            <div style="font-size: 3rem; margin-bottom: 1rem">üíî</div>
            <h3 style="margin-bottom: 1rem">No favorites yet</h3>
            <p
              style="
                font-size: 1.2rem;
                color: var(--gray-medium);
                margin-bottom: 2rem;
              "
            >
              You haven't added any cars to your favorites yet.
            </p>
            <button class="btn btn-primary" @click="currentView = 'browse'">
              Browse Cars
            </button>
          </div>
          
          <!-- Favorites Grid -->
          <div v-else class="car-grid">
            <div
              v-for="car in favorites"
              :key="car._id"
              class="car-card"
              @click="viewCarDetails(car)"
            >
              <div class="car-image">
                <img 
                  :src="getCarImageUrl(car)" 
                  :alt="`${car.make} ${car.model} ${car.year}`"
                  @error="handleImageError($event, car)"
                  loading="lazy"
                />
              </div>
              <div class="car-details">
                <h3 class="car-title">{{ car.make }} {{ car.model }}</h3>
                <div class="car-specs">
                  <span>{{ car.year }}</span>
                  <span>‚Ä¢</span>
                  <span>{{ car.mileage?.toLocaleString() || 'N/A' }} km</span>
                  <span>‚Ä¢</span>
                  <span>{{ car.fuel }}</span>
                </div>
                <div class="car-price">
                  AED {{ car.price?.toLocaleString() || 'N/A' }}
                </div>
                <div class="car-actions">
                  <button class="btn btn-primary" style="flex: 1">
                    View Details
                  </button>
                  <button
                    class="favorite-btn active"
                    @click.stop="toggleFavorite(car)"
                  >
                    ‚ù§Ô∏è
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sell Your Car View -->
        <div v-if="currentView === 'sell'" class="container">
          <h1 style="margin-bottom: 3rem; text-align: center">
            Sell Your Car with AutoSphere
          </h1>

          <!-- Introduction Section -->
          <div style="max-width: 800px; margin: 0 auto 3rem auto; text-align: center">
            <p style="font-size: 1.2rem; color: var(--text-dark); line-height: 1.6; margin-bottom: 2rem">
              Ready to sell your car? Our platform makes it easy to reach thousands of potential buyers. 
              List your vehicle today and get the best value for your car.
            </p>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2rem; margin-bottom: 3rem">
              <div style="text-align: center">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem">üì∏</div>
                <h3 style="margin-bottom: 0.5rem">Upload Photos</h3>
                <p style="color: var(--gray-medium); font-size: 0.9rem">Add high-quality images of your car</p>
              </div>
              <div style="text-align: center">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem">üìù</div>
                <h3 style="margin-bottom: 0.5rem">Add Details</h3>
                <p style="color: var(--gray-medium); font-size: 0.9rem">Provide comprehensive vehicle information</p>
              </div>
              <div style="text-align: center">
                <div style="font-size: 2.5rem; margin-bottom: 0.5rem">üí∞</div>
                <h3 style="margin-bottom: 0.5rem">Set Your Price</h3>
                <p style="color: var(--gray-medium); font-size: 0.9rem">Get market value recommendations</p>
              </div>
            </div>
          </div>

          <!-- Sell Car Form -->
          <div style="max-width: 600px; margin: 0 auto">
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1)">
              <h2 style="margin-bottom: 2rem; color: var(--primary-color)">List Your Vehicle</h2>
              
              <form @submit.prevent="handleSellCar">
                <!-- Vehicle Information -->
                <div style="margin-bottom: 2rem">
                  <h3 style="margin-bottom: 1rem; color: var(--text-dark)">Vehicle Information</h3>
                  
                  <div class="form-group">
                    <label class="form-label">Make *</label>
                    <select class="form-input" v-model="sellForm.make" required>
                      <option value="">Select Make</option>
                      <option value="Toyota">Toyota</option>
                      <option value="Honda">Honda</option>
                      <option value="Mercedes">Mercedes-Benz</option>
                      <option value="BMW">BMW</option>
                      <option value="Nissan">Nissan</option>
                      <option value="Audi">Audi</option>
                      <option value="Porsche">Porsche</option>
                      <option value="Range Rover">Range Rover</option>
                      <option value="Tesla">Tesla</option>
                      <option value="Mazda">Mazda</option>
                      <option value="Ford">Ford</option>
                      <option value="Chevrolet">Chevrolet</option>
                      <option value="Kia">Kia</option>
                      <option value="Hyundai">Hyundai</option>
                      <option value="Volkswagen">Volkswagen</option>
                      <option value="Mitsubishi">Mitsubishi</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Model *</label>
                    <input type="text" class="form-input" v-model="sellForm.model" placeholder="e.g., Camry, Civic, C-Class" required />
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
                    <div class="form-group">
                      <label class="form-label">Year *</label>
                      <select class="form-input" v-model="sellForm.year" required>
                        <option value="">Select Year</option>
                        <option v-for="year in availableYears" :key="year" :value="year">{{ year }}</option>
                      </select>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Fuel Type *</label>
                      <select class="form-input" v-model="sellForm.fuel" required>
                        <option value="">Select Fuel Type</option>
                        <option value="Petrol">Petrol</option>
                        <option value="Diesel">Diesel</option>
                        <option value="Hybrid">Hybrid</option>
                        <option value="Electric">Electric</option>
                      </select>
                    </div>
                  </div>

                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
                    <div class="form-group">
                      <label class="form-label">Mileage (km) *</label>
                      <input type="number" class="form-input" v-model="sellForm.mileage" placeholder="e.g., 50000" required />
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Transmission *</label>
                      <select class="form-input" v-model="sellForm.transmission" required>
                        <option value="">Select Transmission</option>
                        <option value="Automatic">Automatic</option>
                        <option value="Manual">Manual</option>
                        <option value="CVT">CVT</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Color</label>
                    <input type="text" class="form-input" v-model="sellForm.color" placeholder="e.g., White, Black, Silver" />
                  </div>
                </div>

                <!-- Pricing -->
                <div style="margin-bottom: 2rem">
                  <h3 style="margin-bottom: 1rem; color: var(--text-dark)">Pricing</h3>
                  
                  <div class="form-group">
                    <label class="form-label">Asking Price (AED) *</label>
                    <input type="number" class="form-input" v-model="sellForm.price" placeholder="e.g., 75000" required />
                    <small style="color: var(--gray-medium); font-size: 0.8rem">
                      üí° Tip: Research similar vehicles to set a competitive price
                    </small>
                  </div>
                </div>

                <!-- Description -->
                <div style="margin-bottom: 2rem">
                  <h3 style="margin-bottom: 1rem; color: var(--text-dark)">Description</h3>
                  
                  <div class="form-group">
                    <label class="form-label">Vehicle Description *</label>
                    <textarea 
                      class="form-input" 
                      v-model="sellForm.description" 
                      rows="4" 
                      placeholder="Describe your vehicle's condition, features, maintenance history, and any additional details that would interest buyers..."
                      required
                    ></textarea>
                  </div>
                </div>

                <!-- Contact Information -->
                <div style="margin-bottom: 2rem">
                  <h3 style="margin-bottom: 1rem; color: var(--text-dark)">Contact Information</h3>
                  
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem">
                    <div class="form-group">
                      <label class="form-label">Your Name *</label>
                      <input type="text" class="form-input" v-model="sellForm.sellerName" :placeholder="user.name || 'Your full name'" required />
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">Phone Number *</label>
                      <input type="tel" class="form-input" v-model="sellForm.phone" placeholder="+971 50 XXX XXXX" required />
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-input" v-model="sellForm.email" :placeholder="user.email || 'your.email@example.com'" required />
                  </div>

                  <div class="form-group">
                    <label class="form-label">Location (City) *</label>
                    <input type="text" class="form-input" v-model="sellForm.location" placeholder="e.g., Dubai, Abu Dhabi, Sharjah" required />
                  </div>
                </div>

                <!-- Image Upload Section -->
                <div style="margin-bottom: 2rem">
                  <h3 style="margin-bottom: 1rem; color: var(--text-dark)">Photos</h3>
                  
                  <div style="border: 2px dashed var(--gray-light); border-radius: 8px; padding: 2rem; text-align: center; background: #fafafa">
                    <div style="font-size: 3rem; margin-bottom: 1rem">üì∑</div>
                    <h4 style="margin-bottom: 0.5rem">Add Photos of Your Car</h4>
                    <p style="color: var(--gray-medium); margin-bottom: 1rem">
                      High-quality photos help sell your car faster. Include exterior, interior, and engine photos.
                    </p>
                    <button type="button" class="btn btn-outline" style="margin-bottom: 1rem">
                      Choose Photos
                    </button>
                    <p style="font-size: 0.8rem; color: var(--gray-medium)">
                      Maximum 10 photos, 5MB each. Supported formats: JPG, PNG
                    </p>
                  </div>
                </div>

                <!-- Terms and Submit -->
                <div style="margin-bottom: 1rem">
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer">
                    <input type="checkbox" v-model="sellForm.agreeTerms" required />
                    <span style="font-size: 0.9rem">
                      I agree to the <a href="#" style="color: var(--highlight-color)">Terms of Service</a> 
                      and confirm that all information provided is accurate
                    </span>
                  </label>
                </div>

                <div v-if="sellError" style="color: red; margin-bottom: 1rem; font-size: 0.9rem">
                  {{ sellError }}
                </div>

                <div v-if="sellSuccess" style="color: green; margin-bottom: 1rem; font-size: 0.9rem">
                  {{ sellSuccess }}
                </div>

                <button
                  type="submit"
                  class="btn btn-primary"
                  style="width: 100%; font-size: 1.1rem; padding: 1rem"
                  :disabled="isLoading || !sellForm.agreeTerms"
                >
                  <span v-if="isLoading" class="loading-spinner"></span>
                  <span v-else">üöÄ List My Car</span>
                </button>
              </form>
            </div>

            <!-- Benefits Section -->
            <div style="margin-top: 3rem; background: var(--gray-light); padding: 2rem; border-radius: 12px">
              <h3 style="margin-bottom: 1.5rem; text-align: center; color: var(--primary-color)">
                Why Sell with AutoSphere?
              </h3>
              <div style="display: grid; gap: 1rem">
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span style="color: var(--highlight-color); font-size: 1.2rem">‚úì</span>
                  <span>Reach thousands of verified buyers actively looking for cars</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span style="color: var(--highlight-color); font-size: 1.2rem">‚úì</span>
                  <span>Free listing for the first 30 days</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span style="color: var(--highlight-color); font-size: 1.2rem">‚úì</span>
                  <span>Professional photo enhancement and listing optimization</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span style="color: var(--highlight-color); font-size: 1.2rem">‚úì</span>
                  <span>Secure transaction handling and buyer verification</span>
                </div>
                <div style="display: flex; align-items: center; gap: 0.75rem">
                  <span style="color: var(--highlight-color); font-size: 1.2rem">‚úì</span>
                  <span>24/7 support throughout the selling process</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- About View -->
        <div v-if="currentView === 'about'" class="container">
          <h1 style="margin-bottom: 3rem; text-align: center">
            About AutoSphere
          </h1>

          <div style="max-width: 800px; margin: 0 auto">
            <div style="margin-bottom: 3rem">
              <h2 style="color: var(--primary-color); margin-bottom: 1rem">
                Our Mission
              </h2>
              <p
                style="
                  font-size: 1.1rem;
                  line-height: 1.8;
                  color: var(--text-dark);
                "
              >
                AutoSphere is revolutionizing the automotive sales industry in
                the UAE by creating a seamless, transparent, and trustworthy
                online car buying experience. We bridge the gap between
                traditional dealerships and modern digital convenience, making
                car purchasing as simple as a few clicks.
              </p>
            </div>

            <div style="margin-bottom: 3rem">
              <h2 style="color: var(--primary-color); margin-bottom: 1rem">
                Why We're Different
              </h2>
              <div style="display: grid; gap: 1.5rem">
                <div style="display: flex; gap: 1rem; align-items: start">
                  <span style="font-size: 2rem">üéØ</span>
                  <div>
                    <h3 style="margin-bottom: 0.5rem">
                      AI-Powered Recommendations
                    </h3>
                    <p>
                      Our intelligent system analyzes your preferences, budget,
                      and lifestyle to suggest the perfect vehicle matches.
                    </p>
                  </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: start">
                  <span style="font-size: 2rem">üîç</span>
                  <div>
                    <h3 style="margin-bottom: 0.5rem">Complete Transparency</h3>
                    <p>
                      Every vehicle undergoes thorough verification. See
                      detailed history, pricing breakdowns, and all fees
                      upfront.
                    </p>
                  </div>
                </div>
                <div style="display: flex; gap: 1rem; align-items: start">
                  <span style="font-size: 2rem">üí°</span>
                  <div>
                    <h3 style="margin-bottom: 0.5rem">Simplified Process</h3>
                    <p>
                      From browsing to purchase, we've eliminated the
                      complexity. No hidden surprises, no pressure tactics.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div style="margin-bottom: 3rem">
              <h2 style="color: var(--primary-color); margin-bottom: 1rem">
                Our Story
              </h2>
              <p
                style="
                  font-size: 1.1rem;
                  line-height: 1.8;
                  color: var(--text-dark);
                "
              >
                Founded in 2025, AutoSphere emerged from a simple observation:
                buying a car online shouldn't be complicated or risky. Our
                founder, Aung Khant Moe, experienced firsthand the challenges of
                traditional car buying - the multiple dealership visits,
                aggressive sales tactics, and lack of transparency.
              </p>
              <p
                style="
                  font-size: 1.1rem;
                  line-height: 1.8;
                  color: var(--text-dark);
                  margin-top: 1rem;
                "
              >
                Today, AutoSphere serves customers across the UAE, offering a
                curated selection of verified vehicles and a buying experience
                that puts customer needs first. We're not just selling cars;
                we're building trust in online automotive commerce.
              </p>
            </div>

            <div
              style="
                background-color: var(--gray-light);
                padding: 2rem;
                border-radius: 10px;
                margin-bottom: 3rem;
              "
            >
              <h2 style="color: var(--primary-color); margin-bottom: 1rem">
                Our Commitment
              </h2>
              <ul style="list-style: none; padding: 0">
                <li
                  style="
                    margin-bottom: 1rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                  "
                >
                  <span style="color: var(--highlight-color)">‚úì</span>
                  <span
                    >Every vehicle is thoroughly inspected and verified</span
                  >
                </li>
                <li
                  style="
                    margin-bottom: 1rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                  "
                >
                  <span style="color: var(--highlight-color)">‚úì</span>
                  <span>Transparent pricing with no hidden fees</span>
                </li>
                <li
                  style="
                    margin-bottom: 1rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                  "
                >
                  <span style="color: var(--highlight-color)">‚úì</span>
                  <span>7-day return policy for your peace of mind</span>
                </li>
                <li
                  style="
                    margin-bottom: 1rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                  "
                >
                  <span style="color: var(--highlight-color)">‚úì</span>
                  <span>24/7 customer support throughout your journey</span>
                </li>
                <li style="display: flex; align-items: center; gap: 0.5rem">
                  <span style="color: var(--highlight-color)">‚úì</span>
                  <span>Secure online transactions and data protection</span>
                </li>
              </ul>
            </div>

            <div style="text-align: center">
              <h2 style="color: var(--primary-color); margin-bottom: 1rem">
                Ready to Find Your Perfect Car?
              </h2>
              <p style="font-size: 1.1rem; margin-bottom: 2rem">
                Join thousands of satisfied customers who've discovered a better
                way to buy cars.
              </p>
              <button
                class="btn btn-primary"
                @click="currentView = 'browse'"
                style="font-size: 1.1rem; padding: 1rem 2rem"
              >
                Browse Our Inventory
              </button>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <div class="container">
          <div class="footer-content">
            <div class="footer-section">
              <h3>About AutoSphere</h3>
              <p>
                Your trusted partner in finding the perfect vehicle. We combine
                technology with transparency to make car buying seamless.
              </p>
            </div>
            <div class="footer-section">
              <h3>Quick Links</h3>
              <ul class="footer-links">
                <li><a href="#">Browse Cars</a></li>
                <li><a href="#">How It Works</a></li>
                <li><a href="#">Financing Options</a></li>
                <li><a href="#">Contact Support</a></li>
              </ul>
            </div>
            <div class="footer-section">
              <h3>Contact Info</h3>
              <ul class="footer-links">
                <li>üìç Bur Dubai, Dubai, UAE</li>
                <li>üìß info@autosphere.ae</li>
                <li>üìû +971 4 XXX XXXX</li>
              </ul>
            </div>
            <div class="footer-section">
              <h3>Follow Us</h3>
              <p>Stay updated with our latest offers and inventory</p>
            </div>
          </div>
          <div class="footer-bottom">
            <p>
              &copy; 2025 AutoSphere. All rights reserved. | Developed by Aung
              Khant Moe
            </p>
          </div>
        </div>
      </footer>

      <!-- Toast Container -->
      <div class="toast-container">
        <div
          v-for="toast in toasts"
          :key="toast.id"
          class="toast"
          :class="toast.type"
        >
          {{ toast.message }}
        </div>
      </div>

      <!-- Login/Signup Modal -->
      <div v-if="showModal && modalType !== 'testDrive' && modalType !== 'financing'" class="modal-overlay" @click.self="closeModal">
        <div class="modal">
          <div class="modal-header">
            <h2 class="modal-title">Welcome to AutoSphere</h2>
            <button class="close-btn" @click="closeModal">‚úï</button>
          </div>

          <div class="form-tabs">
            <button
              class="tab-btn"
              :class="{active: modalType === 'login'}"
              @click="modalType = 'login'"
            >
              Login
            </button>
            <button
              class="tab-btn"
              :class="{active: modalType === 'signup'}"
              @click="modalType = 'signup'"
            >
              Sign Up
            </button>
          </div>

          <!-- Login Form -->
          <form v-if="modalType === 'login'" @submit.prevent="handleLogin">
            <div class="form-group">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-input"
                v-model="loginForm.email"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <input
                type="password"
                class="form-input"
                v-model="loginForm.password"
                required
              />
            </div>
            <div v-if="loginError" style="color: red; margin-bottom: 1rem; font-size: 0.9rem">
              {{ loginError }}
            </div>
            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; margin-top: 0.5rem"
              :disabled="isLoading"
            >
              <span v-if="isLoading" class="loading-spinner"></span>
              <span v-else>Login</span>
            </button>
            <p
              style="
                text-align: center;
                margin-top: 1rem;
                font-size: 0.85rem;
                color: var(--gray-medium);
              "
            >
              Don't have an account?
              <a
                href="#"
                @click.prevent="modalType = 'signup'"
                style="color: var(--highlight-color); text-decoration: none"
                >Sign up</a
              >
            </p>
          </form>

          <!-- Signup Form -->
          <form v-if="modalType === 'signup'" @submit.prevent="handleSignup">
            <div class="form-group">
              <label class="form-label">Full Name</label>
              <input
                type="text"
                class="form-input"
                v-model="signupForm.name"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input
                type="email"
                class="form-input"
                v-model="signupForm.email"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Password</label>
              <input
                type="password"
                class="form-input"
                v-model="signupForm.password"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Confirm Password</label>
              <input
                type="password"
                class="form-input"
                v-model="signupForm.confirmPassword"
                required
              />
            </div>
            <div v-if="signupError" style="color: red; margin-bottom: 1rem; font-size: 0.9rem">
              {{ signupError }}
            </div>
            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%; margin-top: 0.5rem"
              :disabled="isLoading"
            >
              <span v-if="isLoading" class="loading-spinner"></span>
              <span v-else>Sign Up</span>
            </button>
            <p
              style="
                text-align: center;
                margin-top: 1rem;
                font-size: 0.85rem;
                color: var(--gray-medium);
              "
            >
              Already have an account?
              <a
                href="#"
                @click.prevent="modalType = 'login'"
                style="color: var(--highlight-color); text-decoration: none"
                >Login</a
              >
            </p>
          </form>
        </div>
      </div>

      <!-- Test Drive Modal -->
      <div v-if="showModal && modalType === 'testDrive'" class="modal-overlay" @click.self="closeModal">
        <div class="modal">
          <div class="modal-header">
            <h2 class="modal-title">üöó Book a Test Drive</h2>
            <button class="close-btn" @click="closeModal">‚úï</button>
          </div>

          <div v-if="selectedCar" style="margin-bottom: 2rem; padding: 1rem; background: var(--gray-light); border-radius: 8px;">
            <h4 style="margin-bottom: 0.5rem;">{{ selectedCar.make }} {{ selectedCar.model }}</h4>
            <p style="color: var(--gray-medium); margin: 0;">{{ selectedCar.year }} ‚Ä¢ AED {{ selectedCar.price?.toLocaleString() }}</p>
          </div>

          <form @submit.prevent="handleTestDriveBooking">
            <div class="form-group">
              <label class="form-label">Your Name *</label>
              <input
                type="text"
                class="form-input"
                v-model="testDriveForm.name"
                :placeholder="user.name || 'Your full name'"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Email *</label>
              <input
                type="email"
                class="form-input"
                v-model="testDriveForm.email"
                :placeholder="user.email || 'your.email@example.com'"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Phone Number *</label>
              <input
                type="tel"
                class="form-input"
                v-model="testDriveForm.phone"
                placeholder="+971 50 XXX XXXX"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Preferred Date *</label>
              <input
                type="date"
                class="form-input"
                v-model="testDriveForm.date"
                :min="new Date().toISOString().split('T')[0]"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Preferred Time *</label>
              <select class="form-input" v-model="testDriveForm.time" required>
                <option value="">Select a time</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Special Requests</label>
              <textarea
                class="form-input"
                v-model="testDriveForm.notes"
                rows="3"
                placeholder="Any specific requirements or questions?"
              ></textarea>
            </div>

            <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
              <h5 style="margin-bottom: 0.5rem;">üìã What to Bring:</h5>
              <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem; color: var(--gray-medium);">
                <li>Valid UAE driving license</li>
                <li>Emirates ID or passport</li>
                <li>Comfortable shoes for driving</li>
              </ul>
            </div>

            <div v-if="testDriveError" style="color: red; margin-bottom: 1rem; font-size: 0.9rem">
              {{ testDriveError }}
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%"
              :disabled="isLoading"
            >
              <span v-if="isLoading" class="loading-spinner"></span>
              <span v-else>üìÖ Confirm Test Drive</span>
            </button>
          </form>
        </div>
      </div>

      <!-- Financing Modal -->
      <div v-if="showModal && modalType === 'financing'" class="modal-overlay" @click.self="closeModal">
        <div class="modal">
          <div class="modal-header">
            <h2 class="modal-title">üí≥ Apply for Financing</h2>
            <button class="close-btn" @click="closeModal">‚úï</button>
          </div>

          <form @submit.prevent="handleFinancingApplication">
            <div style="background: var(--gray-light); padding: 1rem; border-radius: 8px; margin-bottom: 2rem;">
              <h5 style="margin-bottom: 0.5rem;">üîí Secure Application</h5>
              <p style="margin: 0; font-size: 0.9rem; color: var(--gray-medium);">
                Your information is encrypted and shared only with approved financing partners.
              </p>
            </div>

            <div class="form-group">
              <label class="form-label">Full Name *</label>
              <input
                type="text"
                class="form-input"
                v-model="financingForm.name"
                :placeholder="user.name || 'Your full name'"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Email *</label>
              <input
                type="email"
                class="form-input"
                v-model="financingForm.email"
                :placeholder="user.email || 'your.email@example.com'"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Phone Number *</label>
              <input
                type="tel"
                class="form-input"
                v-model="financingForm.phone"
                placeholder="+971 50 XXX XXXX"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Monthly Income (AED) *</label>
              <input
                type="number"
                class="form-input"
                v-model="financingForm.income"
                placeholder="15000"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label">Employment Type *</label>
              <select class="form-input" v-model="financingForm.employment" required>
                <option value="">Select employment type</option>
                <option value="employed">Employed</option>
                <option value="self-employed">Self-Employed</option>
                <option value="business-owner">Business Owner</option>
                <option value="retired">Retired</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Bank *</label>
              <select class="form-input" v-model="financingForm.bank" required>
                <option value="">Select your bank</option>
                <option value="emirates-nbd">Emirates NBD</option>
                <option value="adcb">ADCB</option>
                <option value="fab">FAB</option>
                <option value="nbd">NBD</option>
                <option value="cbd">CBD</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div v-if="financingError" style="color: red; margin-bottom: 1rem; font-size: 0.9rem">
              {{ financingError }}
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="width: 100%"
              :disabled="isLoading"
            >
              <span v-if="isLoading" class="loading-spinner"></span>
              <span v-else>üìù Submit Application</span>
            </button>

            <p style="text-align: center; margin-top: 1rem; font-size: 0.8rem; color: var(--gray-medium);">
              By submitting, you agree to share your information with our financing partners.
            </p>
          </form>
        </div>
      </div>

      <!-- Purchase Modal -->
      <div v-if="showModal && modalType === 'purchase'" class="modal-overlay" @click.self="closeModal">
        <div class="modal" style="max-width: 600px;">
          <div class="modal-header">
            <h2 class="modal-title">üõí Complete Your Purchase</h2>
            <button class="close-btn" @click="closeModal">‚úï</button>
          </div>

          <!-- Purchase Progress -->
          <div class="purchase-progress">
            <div class="progress-step" :class="{ active: purchaseStep >= 1 }">
              <div class="step-circle">1</div>
              <span>Details</span>
            </div>
            <div class="progress-step" :class="{ active: purchaseStep >= 2 }">
              <div class="step-circle">2</div>
              <span>Payment</span>
            </div>
            <div class="progress-step" :class="{ active: purchaseStep >= 3 }">
              <div class="step-circle">3</div>
              <span>Delivery</span>
            </div>
          </div>

          <!-- Step 1: Purchase Details -->
          <div v-if="purchaseStep === 1">
            <h4 style="margin-bottom: 1.5rem;">üìã Purchase Information</h4>
            
            <div v-if="selectedCar" style="background: var(--gray-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <h5>{{ selectedCar.make }} {{ selectedCar.model }} {{ selectedCar.year }}</h5>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; font-size: 0.9rem;">
                <div>Vehicle Price: <strong>AED {{ selectedCar.price?.toLocaleString() }}</strong></div>
                <div>Registration: <strong>AED 2,500</strong></div>
                <div>Insurance: <strong>AED 3,200</strong></div>
                <div>Service Fee: <strong>AED 1,000</strong></div>
              </div>
              <hr style="margin: 1rem 0; border: none; border-top: 1px solid #ccc;">
              <div style="font-size: 1.1rem; font-weight: bold;">
                Total: AED {{ ((selectedCar.price || 0) + 6700).toLocaleString() }}
              </div>
            </div>

            <form @submit.prevent="proceedToPayment">
              <div class="form-group">
                <label class="form-label">Full Name *</label>
                <input
                  type="text"
                  class="form-input"
                  v-model="purchaseForm.name"
                  :placeholder="user.name || 'Your full name'"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Email *</label>
                <input
                  type="email"
                  class="form-input"
                  v-model="purchaseForm.email"
                  :placeholder="user.email || 'your.email@example.com'"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Phone Number *</label>
                <input
                  type="tel"
                  class="form-input"
                  v-model="purchaseForm.phone"
                  placeholder="+971 50 XXX XXXX"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Emirates ID *</label>
                <input
                  type="text"
                  class="form-input"
                  v-model="purchaseForm.emiratesId"
                  placeholder="784-XXXX-XXXXXXX-X"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Delivery Address *</label>
                <textarea
                  class="form-input"
                  v-model="purchaseForm.address"
                  rows="3"
                  placeholder="Your complete address for vehicle delivery"
                  required
                ></textarea>
              </div>

              <button type="submit" class="btn btn-primary" style="width: 100%;">
                Continue to Payment ‚Üí
              </button>
            </form>
          </div>

          <!-- Step 2: Payment -->
          <div v-if="purchaseStep === 2">
            <h4 style="margin-bottom: 1.5rem;">üí≥ Payment Method</h4>
            
            <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
              <div 
                class="payment-option" 
                :class="{ active: paymentMethod === 'card' }"
                @click="paymentMethod = 'card'"
                style="border: 2px solid var(--gray-light); padding: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"
              >
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <input type="radio" v-model="paymentMethod" value="card" />
                  <div>
                    <h5 style="margin-bottom: 0.25rem;">üí≥ Credit/Debit Card</h5>
                    <small style="color: var(--gray-medium);">Secure payment via Visa, Mastercard, or local cards</small>
                  </div>
                </div>
              </div>
              
              <div 
                class="payment-option" 
                :class="{ active: paymentMethod === 'bank' }"
                @click="paymentMethod = 'bank'"
                style="border: 2px solid var(--gray-light); padding: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"
              >
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <input type="radio" v-model="paymentMethod" value="bank" />
                  <div>
                    <h5 style="margin-bottom: 0.25rem;">üè¶ Bank Transfer</h5>
                    <small style="color: var(--gray-medium);">Direct transfer from your bank account</small>
                  </div>
                </div>
              </div>
              
              <div 
                class="payment-option" 
                :class="{ active: paymentMethod === 'financing' }"
                @click="paymentMethod = 'financing'"
                style="border: 2px solid var(--gray-light); padding: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"
              >
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <input type="radio" v-model="paymentMethod" value="financing" />
                  <div>
                    <h5 style="margin-bottom: 0.25rem;">üìä Auto Financing</h5>
                    <small style="color: var(--gray-medium);">Monthly payments starting from AED {{ monthlyPayment.toLocaleString() }}</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Card Payment Form -->
            <div v-if="paymentMethod === 'card'" style="background: var(--gray-light); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <div class="form-group">
                <label class="form-label">Card Number *</label>
                <input
                  type="text"
                  class="form-input"
                  placeholder="1234 5678 9012 3456"
                  maxlength="19"
                />
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                  <label class="form-label">Expiry Date *</label>
                  <input
                    type="text"
                    class="form-input"
                    placeholder="MM/YY"
                    maxlength="5"
                  />
                </div>
                <div class="form-group">
                  <label class="form-label">CVV *</label>
                  <input
                    type="text"
                    class="form-input"
                    placeholder="123"
                    maxlength="4"
                  />
                </div>
              </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <button type="button" class="btn btn-outline" @click="purchaseStep = 1">
                ‚Üê Back
              </button>
              <button type="button" class="btn btn-primary" @click="proceedToDelivery">
                Continue to Delivery ‚Üí
              </button>
            </div>
          </div>

          <!-- Step 3: Delivery -->
          <div v-if="purchaseStep === 3">
            <h4 style="margin-bottom: 1.5rem;">üöö Delivery Options</h4>
            
            <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
              <div 
                class="delivery-option" 
                :class="{ active: deliveryMethod === 'home' }"
                @click="deliveryMethod = 'home'"
                style="border: 2px solid var(--gray-light); padding: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"
              >
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <input type="radio" v-model="deliveryMethod" value="home" />
                  <div>
                    <h5 style="margin-bottom: 0.25rem;">üè† Home Delivery</h5>
                    <small style="color: var(--gray-medium);">Free delivery within 3-5 business days</small>
                  </div>
                </div>
              </div>
              
              <div 
                class="delivery-option" 
                :class="{ active: deliveryMethod === 'pickup' }"
                @click="deliveryMethod = 'pickup'"
                style="border: 2px solid var(--gray-light); padding: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;"
              >
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <input type="radio" v-model="deliveryMethod" value="pickup" />
                  <div>
                    <h5 style="margin-bottom: 0.25rem;">üè¢ Showroom Pickup</h5>
                    <small style="color: var(--gray-medium);">Ready for pickup within 24 hours</small>
                  </div>
                </div>
              </div>
            </div>

            <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
              <h5 style="margin-bottom: 1rem;">üìã What Happens Next:</h5>
              <ul style="margin: 0; padding-left: 1.5rem; font-size: 0.9rem; color: var(--gray-medium);">
                <li>Payment processing and verification</li>
                <li>Vehicle preparation and final inspection</li>
                <li>Documentation and registration transfer</li>
                <li>Delivery or pickup coordination</li>
                <li>7-day return guarantee period begins</li>
              </ul>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <button type="button" class="btn btn-outline" @click="purchaseStep = 2">
                ‚Üê Back
              </button>
              <button type="button" class="btn btn-success" @click="completePurchase" :disabled="isLoading">
                <span v-if="isLoading" class="loading-spinner"></span>
                <span v-else">üéâ Complete Purchase</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // API Configuration
                    API_URL: 'https://ug-project1.onrender.com',
                    
                    // UI State
                    currentView: 'home',
                    previousView: 'home',
                    showModal: false,
                    modalType: 'login',
                    isLoading: false,
                    loadingCars: false,
                    loadingFeatured: false,
                    loadingFavorites: false,
                    
                    // Authentication
                    isLoggedIn: false,
                    token: null,
                    user: {
                        name: '',
                        email: ''
                    },
                    
                    // Car Details State
                    selectedCar: null,
                    activeTab: 'installments',
                    currentImageIndex: 0,
                    
                    // Forms
                    searchQuery: '',
                    loginForm: {
                        email: '',
                        password: ''
                    },
                    signupForm: {
                        name: '',
                        email: '',
                        password: '',
                        confirmPassword: ''
                    },
                    sellForm: {
                        make: '',
                        model: '',
                        year: '',
                        fuel: '',
                        mileage: '',
                        transmission: '',
                        color: '',
                        price: '',
                        description: '',
                        sellerName: '',
                        phone: '',
                        email: '',
                        location: '',
                        agreeTerms: false
                    },
                    testDriveForm: {
                        name: '',
                        email: '',
                        phone: '',
                        date: '',
                        time: '',
                        notes: ''
                    },
                    financingForm: {
                        name: '',
                        email: '',
                        phone: '',
                        income: '',
                        employment: '',
                        bank: ''
                    },
                    purchaseForm: {
                        name: '',
                        email: '',
                        phone: '',
                        emiratesId: '',
                        address: ''
                    },
                    
                    // Purchase Process
                    purchaseStep: 1,
                    paymentMethod: 'card',
                    deliveryMethod: 'home',
                    
                    // Installment Calculator
                    installmentCalc: {
                        downPayment: 0,
                        years: 3,
                        interestRate: 4.5
                    },
                    
                    // Error States
                    loginError: '',
                    signupError: '',
                    sellError: '',
                    sellSuccess: '',
                    testDriveError: '',
                    financingError: '',
                    
                    // Filters
                    filters: {
                        make: '',
                        priceRange: '',
                        year: '',
                        fuel: ''
                    },
                    
                    // Data
                    cars: [],
                    featuredCars: [],
                    favorites: [],
                    favoriteIds: new Set(),
                    
                    // Pagination
                    pagination: {
                        current: 1,
                        pages: 1,
                        total: 0
                    },
                    
                    // Toast notifications
                    toasts: [],
                    
                    // Track failed image loads to prevent infinite retry loops
                    imageLoadErrors: new Set()
                }
            },
            computed: {
                availableYears() {
                    const currentYear = new Date().getFullYear();
                    const years = [];
                    for (let year = currentYear; year >= 1990; year--) {
                        years.push(year);
                    }
                    return years;
                },
                carImageUrls() {
                    if (!this.selectedCar) return [];
                    return this.getAllCarImageUrls(this.selectedCar);
                },
                currentImageUrl() {
                    if (!this.selectedCar || this.carImageUrls.length === 0) {
                        return `${this.API_URL}/api/car-image/placeholder.jpg`;
                    }
                    return this.carImageUrls[this.currentImageIndex] || this.carImageUrls[0];
                },
                loanAmount() {
                    if (!this.selectedCar) return 0;
                    const price = this.selectedCar.price || 0;
                    const downPayment = this.installmentCalc.downPayment || (price * 0.2);
                    return Math.max(0, price - downPayment);
                },
                monthlyPayment() {
                    const principal = this.loanAmount;
                    const months = this.installmentCalc.years * 12;
                    const rate = this.installmentCalc.interestRate / 100 / 12;
                    
                    if (principal === 0 || rate === 0) return 0;
                    
                    const payment = principal * (rate * Math.pow(1 + rate, months)) / (Math.pow(1 + rate, months) - 1);
                    return Math.round(payment);
                },
                totalInterest() {
                    const totalPayments = this.monthlyPayment * this.installmentCalc.years * 12;
                    return Math.max(0, totalPayments - this.loanAmount);
                },
                totalPayment() {
                    return this.loanAmount + this.totalInterest + (this.installmentCalc.downPayment || 0);
                },
                visiblePages() {
                    const pages = [];
                    const start = Math.max(1, this.pagination.current - 2);
                    const end = Math.min(this.pagination.pages, this.pagination.current + 2);
                    
                    for (let i = start; i <= end; i++) {
                        pages.push(i);
                    }
                    
                    return pages;
                }
            },
            methods: {
                // Navigation Methods
                viewCarDetails(car) {
                    this.selectedCar = car;
                    this.previousView = this.currentView;
                    this.currentView = 'carDetails';
                    this.currentImageIndex = 0;
                    this.activeTab = 'installments';
                    
                    // Initialize installment calculator with defaults
                    this.installmentCalc.downPayment = Math.round(car.price * 0.2);
                    
                    // Scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                
                goBack() {
                    this.currentView = this.previousView;
                    this.selectedCar = null;
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                },
                
                // Modal Methods
                openTestDriveModal() {
                    if (!this.isLoggedIn) {
                        this.showToast('Please login to book a test drive!', 'error');
                        this.openLogin();
                        return;
                    }
                    
                    this.modalType = 'testDrive';
                    this.showModal = true;
                    
                    // Pre-fill form with user data
                    this.testDriveForm.name = this.user.name;
                    this.testDriveForm.email = this.user.email;
                },
                
                startPurchaseProcess() {
                    if (!this.isLoggedIn) {
                        this.showToast('Please login to purchase this car!', 'error');
                        this.openLogin();
                        return;
                    }
                    
                    this.modalType = 'purchase';
                    this.showModal = true;
                    this.purchaseStep = 1;
                    
                    // Pre-fill form with user data
                    this.purchaseForm.name = this.user.name;
                    this.purchaseForm.email = this.user.email;
                },
                
                applyForFinancing() {
                    if (!this.isLoggedIn) {
                        this.showToast('Please login to apply for financing!', 'error');
                        this.openLogin();
                        return;
                    }
                    
                    this.modalType = 'financing';
                    this.showModal = true;
                    
                    // Pre-fill form with user data
                    this.financingForm.name = this.user.name;
                    this.financingForm.email = this.user.email;
                },
                
                // Form Handlers
                async handleTestDriveBooking() {
                    this.isLoading = true;
                    this.testDriveError = '';
                    
                    try {
                        // Simulate API call since test drive endpoint doesn't exist
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        this.showToast(`Test drive scheduled for ${this.testDriveForm.date} at ${this.testDriveForm.time}!`, 'success');
                        this.closeModal();
                        
                        // Reset form
                        this.testDriveForm = {
                            name: '',
                            email: '',
                            phone: '',
                            date: '',
                            time: '',
                            notes: ''
                        };
                        
                    } catch (error) {
                        this.testDriveError = 'Failed to book test drive. Please try again.';
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                async handleFinancingApplication() {
                    this.isLoading = true;
                    this.financingError = '';
                    
                    try {
                        // Simulate API call
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        this.showToast('Financing application submitted! You will receive a response within 24 hours.', 'success');
                        this.closeModal();
                        
                        // Reset form
                        this.financingForm = {
                            name: '',
                            email: '',
                            phone: '',
                            income: '',
                            employment: '',
                            bank: ''
                        };
                        
                    } catch (error) {
                        this.financingError = 'Failed to submit application. Please try again.';
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                proceedToPayment() {
                    this.purchaseStep = 2;
                },
                
                proceedToDelivery() {
                    this.purchaseStep = 3;
                },
                
                async completePurchase() {
                    this.isLoading = true;
                    
                    try {
                        // Simulate purchase processing
                        await new Promise(resolve => setTimeout(resolve, 3000));
                        
                        this.showToast('üéâ Purchase completed successfully! You will receive confirmation details via email.', 'success');
                        this.closeModal();
                        
                        // Reset purchase form
                        this.purchaseForm = {
                            name: '',
                            email: '',
                            phone: '',
                            emiratesId: '',
                            address: ''
                        };
                        this.purchaseStep = 1;
                        
                        // Go back to previous view
                        this.goBack();
                        
                    } catch (error) {
                        this.showToast('Purchase failed. Please try again.', 'error');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                // Calculator Methods
                calculateInstallment() {
                    // Reactive calculation handled by computed properties
                },
                
                // Enhanced image handling methods
                getCarImageUrl(car) {
                    // Use the primaryImageUrl from the API response
                    if (car.primaryImageUrl) {
                        return `${this.API_URL}${car.primaryImageUrl}`;
                    }
                    
                    // Fallback: construct URL from images array
                    if (car.images && car.images.length > 0) {
                        return `${this.API_URL}/api/car-image/${car.images[0]}`;
                    }
                    
                    // Final fallback: placeholder
                    return `${this.API_URL}/api/car-image/placeholder.jpg`;
                },
                
                getAllCarImageUrls(car) {
                    // Use the imageUrls from the API response
                    if (car.imageUrls && car.imageUrls.length > 0) {
                        return car.imageUrls.map(url => `${this.API_URL}${url}`);
                    }
                    
                    // Fallback: construct URLs from images array
                    if (car.images && car.images.length > 0) {
                        return car.images.map(img => `${this.API_URL}/api/car-image/${img}`);
                    }
                    
                    // Final fallback: placeholder
                    return [`${this.API_URL}/api/car-image/placeholder.jpg`];
                },
                
                // Handle image load errors with retry mechanism
                handleImageError(event, car) {
                    const img = event.target;
                    const currentSrc = img.src;
                    const carId = car._id || car.id;
                    
                    // Avoid infinite loops by tracking failed attempts
                    if (this.imageLoadErrors.has(currentSrc)) {
                        // Create a placeholder div with car info
                        this.createImagePlaceholder(img, car);
                        return;
                    }
                    
                    this.imageLoadErrors.add(currentSrc);
                    
                    // Try the API endpoint if we haven't already
                    if (!currentSrc.includes('/api/car-image/')) {
                        const fallbackUrl = `${this.API_URL}/api/car-image/${car.images?.[0] || 'placeholder.jpg'}`;
                        img.src = fallbackUrl;
                        return;
                    }
                    
                    // If API endpoint also fails, create a styled placeholder
                    this.createImagePlaceholder(img, car);
                },
                
                createImagePlaceholder(img, car) {
                    const container = img.parentElement;
                    if (!container) return;
                    
                    // Hide the broken image
                    img.style.display = 'none';
                    
                    // Create a styled placeholder
                    const placeholder = document.createElement('div');
                    placeholder.className = 'image-placeholder';
                    placeholder.style.cssText = `
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-direction: column;
                        height: 100%;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        text-align: center;
                        border-radius: 8px;
                    `;
                    
                    placeholder.innerHTML = `
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üöó</div>
                        <div style="font-size: 0.9rem; font-weight: 500;">${car.make} ${car.model}</div>
                        <div style="font-size: 0.7rem; opacity: 0.8;">${car.year}</div>
                    `;
                    
                    container.appendChild(placeholder);
                },
                
                // Toast Notifications
                showToast(message, type = 'success') {
                    const toast = {
                        id: Date.now(),
                        message,
                        type
                    };
                    
                    this.toasts.push(toast);
                    
                    setTimeout(() => {
                        this.toasts = this.toasts.filter(t => t.id !== toast.id);
                    }, 3000);
                },
                
                // Authentication Methods
                async checkAuth() {
                    const token = localStorage.getItem('token');
                    if (token) {
                        this.token = token;
                        try {
                            const response = await axios.get(`${this.API_URL}/api/auth/me`, {
                                headers: { 'Authorization': `Bearer ${token}` }
                            });
                            this.user = response.data;
                            this.isLoggedIn = true;
                            await this.loadFavorites();
                        } catch (error) {
                            console.error('Auth check failed:', error);
                            this.logout();
                        }
                    }
                },
                
                openLogin() {
                    this.modalType = 'login';
                    this.showModal = true;
                },
                
                openSignup() {
                    this.modalType = 'signup';
                    this.showModal = true;
                },
                
                closeModal() {
                    this.showModal = false;
                    this.resetForms();
                },
                
                resetForms() {
                    this.loginForm = { email: '', password: '' };
                    this.signupForm = { name: '', email: '', password: '', confirmPassword: '' };
                    this.sellForm = {
                        make: '',
                        model: '',
                        year: '',
                        fuel: '',
                        mileage: '',
                        transmission: '',
                        color: '',
                        price: '',
                        description: '',
                        sellerName: '',
                        phone: '',
                        email: '',
                        location: '',
                        agreeTerms: false
                    };
                    this.testDriveForm = {
                        name: '',
                        email: '',
                        phone: '',
                        date: '',
                        time: '',
                        notes: ''
                    };
                    this.financingForm = {
                        name: '',
                        email: '',
                        phone: '',
                        income: '',
                        employment: '',
                        bank: ''
                    };
                    this.purchaseForm = {
                        name: '',
                        email: '',
                        phone: '',
                        emiratesId: '',
                        address: ''
                    };
                    this.loginError = '';
                    this.signupError = '';
                    this.sellError = '';
                    this.sellSuccess = '';
                    this.testDriveError = '';
                    this.financingError = '';
                },
                
                async handleLogin() {
                    this.isLoading = true;
                    this.loginError = '';
                    
                    try {
                        const response = await axios.post(`${this.API_URL}/api/auth/login`, this.loginForm);
                        
                        this.token = response.data.token;
                        this.user = response.data.user;
                        this.isLoggedIn = true;
                        
                        localStorage.setItem('token', this.token);
                        
                        this.closeModal();
                        this.showToast('Login successful! Welcome back.');
                        
                        // Load favorites after login
                        await this.loadFavorites();
                        
                    } catch (error) {
                        this.loginError = error.response?.data?.error || 'Login failed. Please try again.';
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                async handleSignup() {
                    this.isLoading = true;
                    this.signupError = '';
                    
                    if (this.signupForm.password !== this.signupForm.confirmPassword) {
                        this.signupError = 'Passwords do not match!';
                        this.isLoading = false;
                        return;
                    }
                    
                    try {
                        const response = await axios.post(`${this.API_URL}/api/auth/register`, {
                            name: this.signupForm.name,
                            email: this.signupForm.email,
                            password: this.signupForm.password
                        });
                        
                        this.token = response.data.token;
                        this.user = response.data.user;
                        this.isLoggedIn = true;
                        
                        localStorage.setItem('token', this.token);
                        
                        this.closeModal();
                        this.showToast('Account created successfully! Welcome to AutoSphere.');
                        
                    } catch (error) {
                        this.signupError = error.response?.data?.error || 'Signup failed. Please try again.';
                    } finally {
                        this.isLoading = false;
                    }
                },

                async handleSellCar() {
                    if (!this.isLoggedIn) {
                        this.sellError = 'Please login to list your car for sale.';
                        this.showToast('Please login to list your car.', 'error');
                        this.openLogin();
                        return;
                    }

                    this.isLoading = true;
                    this.sellError = '';
                    this.sellSuccess = '';

                    try {
                        // Note: Since there's no sell endpoint in the server.js, 
                        // we'll simulate the submission for now
                        this.sellSuccess = 'Your car listing has been submitted! We will review it and contact you within 24 hours.';
                        this.showToast('Car listing submitted successfully!', 'success');
                        
                        // Reset the form after successful submission
                        this.sellForm = {
                            make: '',
                            model: '',
                            year: '',
                            fuel: '',
                            mileage: '',
                            transmission: '',
                            color: '',
                            price: '',
                            description: '',
                            sellerName: '',
                            phone: '',
                            email: '',
                            location: '',
                            agreeTerms: false
                        };

                        // Scroll to success message
                        setTimeout(() => {
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        }, 100);

                    } catch (error) {
                        console.error('Error submitting car listing:', error);
                        this.sellError = 'Failed to submit your car listing. Please try again.';
                        this.showToast('Failed to submit car listing. Please try again.', 'error');
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                logout() {
                    this.isLoggedIn = false;
                    this.user = { name: '', email: '' };
                    this.token = null;
                    this.favorites = [];
                    this.favoriteIds.clear();
                    localStorage.removeItem('token');
                    this.showToast('You have been logged out.');
                    
                    if (this.currentView === 'favorites') {
                        this.currentView = 'home';
                    }
                },
                
                // Car Methods
                async loadCars(page = 1) {
                    this.loadingCars = true;
                    
                    try {
                        const params = {
                            page,
                            search: this.searchQuery,
                            make: this.filters.make,
                            year: this.filters.year,
                            fuel: this.filters.fuel
                        };
                        
                        // Handle price range
                        if (this.filters.priceRange) {
                            if (this.filters.priceRange === '0-50000') {
                                params.priceMax = 50000;
                            } else if (this.filters.priceRange === '50000-100000') {
                                params.priceMin = 50000;
                                params.priceMax = 100000;
                            } else if (this.filters.priceRange === '100000-200000') {
                                params.priceMin = 100000;
                                params.priceMax = 200000;
                            } else if (this.filters.priceRange === '200000+') {
                                params.priceMin = 200000;
                            }
                        }
                        
                        const response = await axios.get(`${this.API_URL}/api/cars`, { params });
                        
                        this.cars = response.data.cars;
                        this.pagination = response.data.pagination;
                        
                    } catch (error) {
                        console.error('Error loading cars:', error);
                        this.showToast('Failed to load cars. Please try again.', 'error');
                    } finally {
                        this.loadingCars = false;
                    }
                },
                
                async loadFeaturedCars() {
                    this.loadingFeatured = true;
                    
                    try {
                        const response = await axios.get(`${this.API_URL}/api/cars`, {
                            params: { featured: true, limit: 6 }
                        });
                        
                        this.featuredCars = response.data.cars;
                        
                    } catch (error) {
                        console.error('Error loading featured cars:', error);
                        this.showToast('Failed to load featured cars.', 'error');
                    } finally {
                        this.loadingFeatured = false;
                    }
                },
                
                async loadFavorites() {
                    if (!this.isLoggedIn) return;
                    
                    this.loadingFavorites = true;
                    
                    try {
                        const response = await axios.get(`${this.API_URL}/api/favorites`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        this.favorites = response.data;
                        this.favoriteIds = new Set(response.data.map(car => car._id));
                        
                    } catch (error) {
                        console.error('Error loading favorites:', error);
                    } finally {
                        this.loadingFavorites = false;
                    }
                },
                
                searchCars() {
                    this.currentView = 'browse';
                    this.loadCars();
                },
                
                changePage(page) {
                    if (page >= 1 && page <= this.pagination.pages) {
                        this.loadCars(page);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                async toggleFavorite(car) {
                    if (!this.isLoggedIn) {
                        this.showToast('Please login to add favorites!', 'error');
                        this.openLogin();
                        return;
                    }
                    
                    try {
                        if (this.isFavorite(car._id)) {
                            // Remove from favorites
                            await axios.delete(`${this.API_URL}/api/favorites/${car._id}`, {
                                headers: { 'Authorization': `Bearer ${this.token}` }
                            });
                            
                            this.favoriteIds.delete(car._id);
                            this.favorites = this.favorites.filter(f => f._id !== car._id);
                            this.showToast('Removed from favorites');
                            
                        } else {
                            // Add to favorites
                            await axios.post(`${this.API_URL}/api/favorites/${car._id}`, {}, {
                                headers: { 'Authorization': `Bearer ${this.token}` }
                            });
                            
                            this.favoriteIds.add(car._id);
                            if (this.currentView === 'favorites') {
                                await this.loadFavorites();
                            }
                            this.showToast('Added to favorites');
                        }
                        
                    } catch (error) {
                        console.error('Error toggling favorite:', error);
                        this.showToast('Failed to update favorites', 'error');
                    }
                },
                
                isFavorite(carId) {
                    return this.favoriteIds.has(carId);
                }
            },
            async mounted() {
                // Check authentication on mount
                await this.checkAuth();
                
                // Load featured cars on home page
                await this.loadFeaturedCars();
                
                // Watch for view changes
                this.$watch('currentView', (newView) => {
                    if (newView === 'browse' && this.cars.length === 0) {
                        this.loadCars();
                    } else if (newView === 'favorites' && this.isLoggedIn) {
                        this.loadFavorites();
                    } else if (newView === 'sell' && this.isLoggedIn) {
                        // Pre-fill user information in sell form
                        this.sellForm.sellerName = this.user.name;
                        this.sellForm.email = this.user.email;
                    }
                });
                
                // Watch for filter changes
                this.$watch('filters', () => {
                    if (this.currentView === 'browse') {
                        this.loadCars();
                    }
                }, { deep: true });
                
                // Style payment and delivery options
                this.$nextTick(() => {
                    // Add dynamic styles for payment options
                    const style = document.createElement('style');
                    style.textContent = `
                        .payment-option.active,
                        .delivery-option.active {
                            border-color: var(--primary-color) !important;
                            background: rgba(0, 123, 255, 0.05);
                        }
                        .form-tabs {
                            display: flex;
                            border-bottom: 2px solid var(--gray-light);
                            margin-bottom: 2rem;
                        }
                        .tab-btn {
                            padding: 1rem 2rem;
                            border: none;
                            background: none;
                            cursor: pointer;
                            font-weight: 500;
                            color: var(--gray-medium);
                            border-bottom: 3px solid transparent;
                            transition: all 0.3s ease;
                        }
                        .tab-btn.active {
                            color: var(--primary-color);
                            border-bottom-color: var(--primary-color);
                        }
                    `;
                    document.head.appendChild(style);
                });
            }
        }).mount('#app');
    </script>
  </body>
</html>
